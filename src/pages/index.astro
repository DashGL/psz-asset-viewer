---
import { existsSync, readdirSync, statSync } from 'fs';
import { join } from 'path';

// Count assets in each area
function countAssets(cityDir: string): number {
  if (!existsSync(cityDir)) return 0;

  return readdirSync(cityDir).filter(name => {
    const fullPath = join(cityDir, name);
    return statSync(fullPath).isDirectory();
  }).length;
}

const cityACount = countAssets('./public/city_a');
const cityECount = countAssets('./public/city_e');
const valleyACount = countAssets('./public/valley_a');
const valleyBCount = countAssets('./public/valley_b');
const valleyECount = countAssets('./public/valley_e');
const valleyZCount = countAssets('./public/valley_z');
const wetlandsACount = countAssets('./public/wetlands_a');
const wetlandsBCount = countAssets('./public/wetlands_b');
const wetlandsECount = countAssets('./public/wetlands_e');
const wetlandsZCount = countAssets('./public/wetlands_z');
const snowfieldACount = countAssets('./public/snowfield_a');
const snowfieldBCount = countAssets('./public/snowfield_b');
const snowfieldECount = countAssets('./public/snowfield_e');
const snowfieldZCount = countAssets('./public/snowfield_z');
const makaraACount = countAssets('./public/makara_a');
const makaraBCount = countAssets('./public/makara_b');
const makaraECount = countAssets('./public/makara_e');
const makaraZCount = countAssets('./public/makara_z');
const paruACount = countAssets('./public/paru_a');
const paruBCount = countAssets('./public/paru_b');
const paruECount = countAssets('./public/paru_e');
const paruZCount = countAssets('./public/paru_z');
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PSZ Asset Viewer</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: #0a0a0a;
        color: #ffffff;
        font-family: system-ui, -apple-system, sans-serif;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem;
      }

      .container {
        max-width: 800px;
        width: 100%;
      }

      h1 {
        font-size: 3rem;
        margin-bottom: 1rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .subtitle {
        font-size: 1.2rem;
        color: #888;
        margin-bottom: 3rem;
      }

      .cities {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
      }

      .city-card {
        background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%);
        border: 1px solid #333;
        border-radius: 12px;
        padding: 2rem;
        text-decoration: none;
        color: white;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .city-card:hover {
        transform: translateY(-4px);
        border-color: #667eea;
        box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2);
      }

      .city-card h2 {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }

      .city-card .count {
        font-size: 1rem;
        color: #888;
        margin-bottom: 1rem;
      }

      .city-card .description {
        font-size: 0.9rem;
        color: #aaa;
        line-height: 1.5;
      }

      .status {
        background: #1a1a1a;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 1.5rem;
      }

      .status h3 {
        font-size: 1.2rem;
        margin-bottom: 1rem;
        color: #667eea;
      }

      .status code {
        background: #0a0a0a;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.9rem;
      }

      .status p {
        margin-bottom: 0.5rem;
        color: #aaa;
      }

      .status a {
        color: #667eea;
        text-decoration: none;
      }

      .status a:hover {
        text-decoration: underline;
      }

      .no-assets {
        color: #ff6b6b;
      }

      .has-assets {
        color: #51cf66;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Phantasy Star Zero</h1>
      <p class="subtitle">Scene Asset Viewer</p>

      <h2 style="margin-bottom: 1rem; font-size: 1.5rem;">City (Scene 00)</h2>
      <div class="cities">
        <a href="/city_a" class="city-card">
          <h2>City - Area A</h2>
          <div class="count">
            {cityACount > 0
              ? `${cityACount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            City 'a' area assets. Buildings and environment pieces.
          </p>
        </a>

        <a href="/city_e" class="city-card">
          <h2>City - Area E</h2>
          <div class="count">
            {cityECount > 0
              ? `${cityECount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            City 'e' area assets. Environmental structures and objects.
          </p>
        </a>
      </div>

      <h2 style="margin: 2rem 0 1rem 0; font-size: 1.5rem;">Gurhacia Valley (Scene 01)</h2>
      <div class="cities">
        <a href="/valley_a" class="city-card">
          <h2>Valley - Area A</h2>
          <div class="count">
            {valleyACount > 0
              ? `${valleyACount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Gurhacia Valley 'a' area assets.
          </p>
        </a>

        <a href="/valley_b" class="city-card">
          <h2>Valley - Area B</h2>
          <div class="count">
            {valleyBCount > 0
              ? `${valleyBCount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Gurhacia Valley 'b' area assets.
          </p>
        </a>

        <a href="/valley_e" class="city-card">
          <h2>Valley - Area E</h2>
          <div class="count">
            {valleyECount > 0
              ? `${valleyECount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Gurhacia Valley 'e' area assets.
          </p>
        </a>

        <a href="/valley_z" class="city-card">
          <h2>Valley - Area Z</h2>
          <div class="count">
            {valleyZCount > 0
              ? `${valleyZCount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Gurhacia Valley 'z' area assets.
          </p>
        </a>
      </div>

      <h2 style="margin: 2rem 0 1rem 0; font-size: 1.5rem;">Ozette Wetlands (Scene 02)</h2>
      <div class="cities">
        <a href="/wetlands_a" class="city-card">
          <h2>Wetlands - Area A</h2>
          <div class="count">
            {wetlandsACount > 0
              ? `${wetlandsACount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Ozette Wetlands 'a' area assets.
          </p>
        </a>

        <a href="/wetlands_b" class="city-card">
          <h2>Wetlands - Area B</h2>
          <div class="count">
            {wetlandsBCount > 0
              ? `${wetlandsBCount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Ozette Wetlands 'b' area assets.
          </p>
        </a>

        <a href="/wetlands_e" class="city-card">
          <h2>Wetlands - Area E</h2>
          <div class="count">
            {wetlandsECount > 0
              ? `${wetlandsECount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Ozette Wetlands 'e' area assets.
          </p>
        </a>

        <a href="/wetlands_z" class="city-card">
          <h2>Wetlands - Area Z</h2>
          <div class="count">
            {wetlandsZCount > 0
              ? `${wetlandsZCount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Ozette Wetlands 'z' area assets.
          </p>
        </a>
      </div>

      <h2 style="margin: 2rem 0 1rem 0; font-size: 1.5rem;">Rioh Snowfield (Scene 03)</h2>
      <div class="cities">
        <a href="/snowfield_a" class="city-card">
          <h2>Snowfield - Area A</h2>
          <div class="count">
            {snowfieldACount > 0
              ? `${snowfieldACount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Rioh Snowfield 'a' area assets.
          </p>
        </a>

        <a href="/snowfield_b" class="city-card">
          <h2>Snowfield - Area B</h2>
          <div class="count">
            {snowfieldBCount > 0
              ? `${snowfieldBCount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Rioh Snowfield 'b' area assets.
          </p>
        </a>

        <a href="/snowfield_e" class="city-card">
          <h2>Snowfield - Area E</h2>
          <div class="count">
            {snowfieldECount > 0
              ? `${snowfieldECount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Rioh Snowfield 'e' area assets.
          </p>
        </a>

        <a href="/snowfield_z" class="city-card">
          <h2>Snowfield - Area Z</h2>
          <div class="count">
            {snowfieldZCount > 0
              ? `${snowfieldZCount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Rioh Snowfield 'z' area assets.
          </p>
        </a>
      </div>

      <h2 style="margin: 2rem 0 1rem 0; font-size: 1.5rem;">Makara Ruins (Scene 04)</h2>
      <div class="cities">
        <a href="/makara_a" class="city-card">
          <h2>Makara - Area A</h2>
          <div class="count">
            {makaraACount > 0
              ? `${makaraACount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Makara Ruins 'a' area assets.
          </p>
        </a>

        <a href="/makara_b" class="city-card">
          <h2>Makara - Area B</h2>
          <div class="count">
            {makaraBCount > 0
              ? `${makaraBCount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Makara Ruins 'b' area assets.
          </p>
        </a>

        <a href="/makara_e" class="city-card">
          <h2>Makara - Area E</h2>
          <div class="count">
            {makaraECount > 0
              ? `${makaraECount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Makara Ruins 'e' area assets.
          </p>
        </a>

        <a href="/makara_z" class="city-card">
          <h2>Makara - Area Z</h2>
          <div class="count">
            {makaraZCount > 0
              ? `${makaraZCount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Makara Ruins 'z' area assets.
          </p>
        </a>
      </div>

      <h2 style="margin: 2rem 0 1rem 0; font-size: 1.5rem;">Oblivion City Paru (Scene 05)</h2>
      <div class="cities">
        <a href="/paru_a" class="city-card">
          <h2>Paru - Area A</h2>
          <div class="count">
            {paruACount > 0
              ? `${paruACount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Oblivion City Paru 'a' area assets.
          </p>
        </a>

        <a href="/paru_b" class="city-card">
          <h2>Paru - Area B</h2>
          <div class="count">
            {paruBCount > 0
              ? `${paruBCount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Oblivion City Paru 'b' area assets.
          </p>
        </a>

        <a href="/paru_e" class="city-card">
          <h2>Paru - Area E</h2>
          <div class="count">
            {paruECount > 0
              ? `${paruECount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Oblivion City Paru 'e' area assets.
          </p>
        </a>

        <a href="/paru_z" class="city-card">
          <h2>Paru - Area Z</h2>
          <div class="count">
            {paruZCount > 0
              ? `${paruZCount} assets available`
              : 'No assets processed yet'
            }
          </div>
          <p class="description">
            Oblivion City Paru 'z' area assets.
          </p>
        </a>
      </div>

      {(cityACount === 0 && cityECount === 0 && valleyACount === 0 && wetlandsACount === 0 && snowfieldACount === 0 && makaraACount === 0 && paruACount === 0) && (
        <div class="status">
          <h3>Getting Started</h3>
          <p>No processed assets found. To get started:</p>
          <ol style="margin-left: 1.5rem; margin-top: 1rem; line-height: 1.8;">
            <li>Make sure your NARC/NSBTX files are in <code>raw/scene/</code></li>
            <li>Install apicula: <a href="https://github.com/scurest/apicula" target="_blank">scurest/apicula</a></li>
            <li>Run a processing script:
              <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                <li><code>npm run processCity</code> - Process City (Scene 00)</li>
                <li><code>npm run processValley</code> - Process Gurhacia Valley (Scene 01)</li>
                <li><code>npm run processWetlands</code> - Process Ozette Wetlands (Scene 02)</li>
                <li><code>npm run processSnowfield</code> - Process Rioh Snowfield (Scene 03)</li>
                <li><code>npm run processMakara</code> - Process Makara Ruins (Scene 04)</li>
                <li><code>npm run processParu</code> - Process Oblivion City Paru (Scene 05)</li>
              </ul>
            </li>
            <li>Refresh this page to see the processed assets</li>
          </ol>
        </div>
      )}

      {(cityACount > 0 || cityECount > 0) && (
        <div class="status">
          <h3>Controls</h3>
          <ul style="margin-left: 1.5rem; line-height: 1.8; color: #aaa;">
            <li><strong>Rotate:</strong> Left-click and drag</li>
            <li><strong>Zoom:</strong> Mouse wheel or pinch</li>
            <li><strong>Pan:</strong> Right-click and drag</li>
          </ul>
        </div>
      )}
    </div>
  </body>
</html>
